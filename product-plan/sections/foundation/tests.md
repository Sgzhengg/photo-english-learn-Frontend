# Test Instructions: Foundation (基础模块)

这些测试说明**与框架无关**。请适应到您的测试设置（Jest、Vitest、Playwright、Cypress 等）。

## 概述

基础模块提供用户认证、注册和引导流程。测试重点包括表单验证、认证流程、导航转换和引导完成。

---

## 用户流程测试

### 流程 1: 用户登录

**场景:** 已注册用户使用邮箱/手机号和密码登录应用

#### 成功路径

**前置条件:**
- 用户已注册，账号已激活
- 用户知道正确的邮箱/手机号和密码

**步骤:**
1. 用户导航到 `/login` 路由
2. 用户看到标题 "欢迎回来"
3. 用户在"邮箱或手机号"输入框输入 `john.doe@example.com`
4. 用户在"密码"输入框输入密码（字符被隐藏）
5. 用户点击"登录"按钮
6. 按钮显示"登录中..."加载状态

**预期结果:**
- [ ] 认证成功后，用户被重定向到主页
- [ ] 如果是首次登录且未完成引导，跳转到引导页面
- [ ] 如果已完成引导，跳转到拍照页面
- [ ] 登录状态被持久化（localStorage/cookie）
- [ ] 用户头像显示在顶部导航栏

#### 失败路径: 凭据错误

**前置条件:**
- 用户输入错误的邮箱或密码

**步骤:**
1. 用户在"邮箱或手机号"输入框输入 `error@example.com`
2. 用户在"密码"输入框输入 `wrongpassword`
3. 用户点击"登录"按钮

**预期结果:**
- [ ] 显示错误提示框或消息："邮箱或密码错误"
- [ ] 错误消息使用红色背景和图标
- [ ] 表单数据保留，用户可以重试
- [ ] "登录"按钮恢复可点击状态
- [ ] 没有导航跳转发生

#### 失败路径: 空字段验证

**步骤:**
1. 用户留空"邮箱或手机号"输入框
2. 用户在"密码"输入框输入任意密码
3. 用户点击"登录"按钮

**预期结果:**
- [ ] 表单不提交
- [ ] 输入框显示红色边框或错误提示
- [ ] 显示验证错误："请输入邮箱或手机号"

---

### 流程 2: 用户注册

**场景:** 新用户创建账号

#### 成功路径

**前置条件:**
- 用户是首次使用，没有账号

**步骤:**
1. 用户在登录页面点击"还没有账号？立即注册"链接
2. 导航到注册页面
3. 用户看到标题 "创建账号"
4. 用户在"邮箱或手机号"输入框输入 `newuser@example.com`
5. 用户点击"发送验证码"按钮
6. 按钮变为倒计时状态 "60秒"
7. 用户在"验证码"输入框输入收到的6位验证码
8. 用户在"设置密码"输入框输入密码（至少8位）
9. 密码强度指示器显示强度等级（弱/中/强）
10. 用户在"确认密码"输入框输入相同密码
11. 用户勾选"我已阅读并同意用户协议和隐私政策"
12. 用户点击"注册"按钮
13. 按钮显示"注册中..."加载状态

**预期结果:**
- [ ] 注册成功后，自动跳转到引导页面
- [ ] 用户会话已建立（已登录状态）
- [ ] 用户数据已保存到数据库
- [ ] 显示欢迎消息或成功提示

#### 失败路径: 密码不一致

**步骤:**
1. 用户在"设置密码"输入框输入 `password123`
2. 用户在"确认密码"输入框输入 `different456`
3. 用户点击"注册"按钮

**预期结果:**
- [ ] 确认密码输入框下方显示错误："两次输入的密码不一致"
- [ ] 显示红色 X 图标在确认密码框
- [ ] 表单不提交
- [ ] 用户可以修改密码后重试

#### 失败路径: 弱密码警告

**步骤:**
1. 用户在"设置密码"输入框输入 `123`（太短）
2. 密码强度指示器显示

**预期结果:**
- [ ] 密码强度条显示红色（弱）
- [ ] 显示文字 "密码强度: 弱"
- [ ] 注册按钮可以被点击，但建议用户使用更强的密码

---

### 流程 3: 新用户引导

**场景:** 首次登录用户完成应用引导

#### 成功路径

**前置条件:**
- 用户刚完成注册或首次登录
- `hasCompletedOnboarding: false`

**步骤:**
1. 用户看到引导页面第 1 页
2. 显示欢迎标题 "欢迎使用 PhotoEnglish" 和 📸 图标
3. 用户点击"下一步"按钮
4. 滑动到第 2 页，显示"拍照识别生词"功能介绍
5. 用户点击"下一步"按钮
6. 滑动到第 3 页，显示"语境化练习"功能介绍
7. 用户点击"下一步"按钮
8. 滑动到第 4 页，显示"设置学习目标"
9. 用户选择英语水平（如"中级"）
10. 用户选择每日学习目标（如"每天 20 个单词"）
11. 用户点击"开始使用"按钮

**预期结果:**
- [ ] 引导完成后，跳转到拍照页面
- [ ] 用户的偏好设置（英语水平、每日目标）已保存
- [ ] `hasCompletedOnboarding` 设置为 `true`
- [ ] 下次登录不再显示引导页面

#### 跳过路径

**步骤:**
1. 用户在引导页任意页面点击"跳过"按钮

**预期结果:**
- [ ] 跳转到拍照页面
- [ ] 使用默认偏好设置（中级、每天20个单词）
- [ ] 标记 `hasCompletedOnboarding: true`

---

## 空状态测试

### 无用户会话状态

**场景:** 用户未登录或会话已过期

**前置条件:**
- localStorage/cookie 中没有有效的认证令牌

**预期结果:**
- [ ] 自动重定向到登录页面
- [ ] 受保护的页面（生词库、练习、统计）无法访问
- [ ] 尝试访问受保护页面时重定向到登录页

---

## 组件交互测试

### LoginPage

**渲染正确:**
- [ ] 显示应用 Logo 和名称 "PhotoEnglish"
- [ ] 显示标题 "欢迎回来"
- [ ] 显示两个输入框：邮箱/手机号、密码
- [ ] 显示"保持登录状态"复选框
- [ ] 显示"忘记密码？"链接
- [ ] 显示"登录"主按钮
- [ ] 显示"还没有账号？立即注册"链接
- [ ] 显示底部用户协议和隐私政策链接

**用户交互:**
- [ ] 点击"眼睛"图标切换密码可见性
- [ ] 点击"忘记密码？"调用 `onForgotPassword` 回调
- [ ] 点击"还没有账号？立即注册"调用 `onGoToRegister` 回调
- [ ] 按下 Enter 键提交表单（当表单有效时）
- [ ] "保持登录状态"复选框切换选中状态

**加载和错误状态:**
- [ ] 登录中显示 "登录中..." 文本
- [ ] 登录中按钮禁用（opacity: 0.5）
- [ ] 错误消息显示在表单顶部
- [ ] 错误消息包含红色背景和警告图标

---

### RegisterPage

**渲染正确:**
- [ ] 显示所有必需的输入字段
- [ ] 显示密码强度指示器
- [ ] 显示"发送验证码"按钮和倒计时
- [ ] 显示用户协议复选框
- [ ] 显示"注册"按钮
- [ ] 显示"已有账号？立即登录"链接

**用户交互:**
- [ ] 点击"发送验证码"开始60秒倒计时
- [ ] 倒计时期间按钮禁用，显示剩余秒数
- [ ] 密码强度实时更新（弱/中/强）
- [ ] 确认密码实时验证并显示图标（✓ 或 ✗）

**验证:**
- [ ] 邮箱/手机号格式验证
- [ ] 验证码必须是6位数字
- [ ] 密码至少8位
- [ ] 密码和确认密码必须匹配
- [ ] 必须勾选用户协议复选框

---

### OnboardingPage

**渲染正确:**
- [ ] 显示当前步骤的图标、标题和描述
- [ ] 显示分页指示器（小圆点）
- [ ] 当前步骤的小圆点被高亮
- [ ] 显示"上一步"按钮（第1步除外）
- [ ] 显示"跳过"按钮（第4步除外）
- [ ] 显示"下一步/开始使用"按钮

**第4步 - 偏好设置:**
- [ ] 显示3个英语水平选项
- [ ] 显示4个每日学习目标选项
- [ ] 选中的选项有高亮边框和 ✓ 图标
- [ ] 只有不选择时，"开始使用"按钮禁用

**用户交互:**
- [ ] 点击"下一步"进入下一步
- [ ] 点击"上一步"返回上一步
- [ ] 点击"跳过"使用默认设置并完成
- [ ] 点击英语水平选项选中该选项
- [ ] 点击每日目标选项选中该选项

---

## 边界情况

- [ ] 处理非常长的邮箱地址（文本截断）
- [ ] 处理特殊字符在密码中
- [ ] 处理网络错误（API超时、连接失败）
- [ ] 处理验证码过期
- [ ] 处理验证码错误（超过尝试次数）
- [ ] 处理会话过期（自动登出）
- [ ] 从空到有数据：注册成功后跳转
- [ ] 从有数据到空：登出后状态清除

---

## 可访问性检查

- [ ] 所有交互元素可键盘访问
- [ ] 表单字段有关联的 label
- [ ] 错误消息被屏幕阅读器宣布
- [ ] 焦点在步骤间正确管理
- [ ] 密码字段有 aria-label
- [ ] 按钮有明确的 aria 标签

---

## 示例测试数据

```typescript
// 成功登录
const validLogin = {
  emailOrPhone: 'john.doe@example.com',
  password: 'SecurePass123',
  keepLoggedIn: true
};

// 失败登录 - 错误密码
const invalidLogin = {
  emailOrPhone: 'john.doe@example.com',
  password: 'WrongPassword',
  keepLoggedIn: false
};

// 成功注册
const validRegistration = {
  emailOrPhone: 'newuser@example.com',
  verificationCode: '123456',
  password: 'SecurePass123',
  confirmPassword: 'SecurePass123',
  agreeToTerms: true
};

// 密码不一致
const passwordMismatch = {
  emailOrPhone: 'newuser@example.com',
  verificationCode: '123456',
  password: 'Password1',
  confirmPassword: 'Password2',
  agreeToTerms: true
};

// 引导偏好设置
const validPreferences = {
  englishLevel: 'intermediate',
  dailyGoal: '20'
};
```

---

## 注意事项

- Mock API 调用以测试成功和失败场景
- 测试每个回调 prop 被正确调用并传递正确的参数
- 验证 UI 优化更新（如密码强度实时显示）
- 测试加载状态在异步操作期间显示
- 确保错误边界优雅地捕获并显示错误
- **始终测试空状态** — 验证首次使用的体验
